<!DOCTYPE html>
<html class="writer-html5" lang="English/Python">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>coreBN.factors.distributions.CanonicalDistribution &mdash; gABi 00.00.01 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            gABi
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">coreBN</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">gABi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">coreBN.factors.distributions.CanonicalDistribution</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for coreBN.factors.distributions.CanonicalDistribution</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">coreBN.factors.distributions</span> <span class="kn">import</span> <span class="n">BaseDistribution</span>
<span class="kn">from</span> <span class="nn">coreBN.factors.distributions</span> <span class="kn">import</span> <span class="n">GaussianDistribution</span>


<div class="viewcode-block" id="CanonicalDistribution"><a class="viewcode-back" href="../../../../coreBN.factors.distributions.html#coreBN.factors.continuous.CanonicalDistribution">[docs]</a><span class="k">class</span> <span class="nc">CanonicalDistribution</span><span class="p">(</span><span class="n">BaseDistribution</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The intermediate factors in a Gaussian network can be described</span>
<span class="sd">    compactly using a simple parametric representation called the</span>
<span class="sd">    canonical form. This representation is closed under the basic</span>
<span class="sd">    operations used in inference: factor product, factor division,</span>
<span class="sd">    factor reduction, and marginalization. Thus, we define this</span>
<span class="sd">    CanonicalDistribution class that allows the inference process to be</span>
<span class="sd">    performed on joint Gaussian networks.</span>

<span class="sd">    A canonical form C (X; K,h,g) is defined as</span>

<span class="sd">    C (X; K,h,g) = exp( ((-1/2) * X.T * K * X) + (h.T * X) + g)</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Probabilistic Graphical Models, Principles and Techniques,</span>
<span class="sd">    Daphne Koller and Nir Friedman, Section 14.2, Chapter 14.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variables: list or array-like</span>
<span class="sd">        The variables for wich the distribution is defined.</span>

<span class="sd">        K: n x n, 2-d array-like</span>

<span class="sd">        h : n x 1, array-like</span>

<span class="sd">        g : int, float</span>

<span class="sd">        pdf: function</span>
<span class="sd">        The probability density function of the distribution.</span>

<span class="sd">        The terms K, h and g are defined parameters for canonical</span>
<span class="sd">        factors representation.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from coreBN.factors.continuous import CanonicalDistribution</span>
<span class="sd">        &gt;&gt;&gt; phi = CanonicalDistribution([&#39;X&#39;, &#39;Y&#39;], np.array([[1, -1], [-1, 1]]),</span>
<span class="sd">                                  np.array([[1], [-1]]), -3)</span>
<span class="sd">        &gt;&gt;&gt; phi.variables</span>
<span class="sd">        [&#39;X&#39;, &#39;Y&#39;]</span>

<span class="sd">        &gt;&gt;&gt; phi.K</span>
<span class="sd">        array([[1, -1],</span>
<span class="sd">               [-1, 1]])</span>

<span class="sd">        &gt;&gt;&gt; phi.h</span>
<span class="sd">        array([[1],</span>
<span class="sd">               [-1]])</span>

<span class="sd">        &gt;&gt;&gt; phi.g</span>
<span class="sd">        -3</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">no_of_var</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">!=</span> <span class="n">no_of_var</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Length of h parameter vector must be equal to &quot;</span>
                <span class="s2">&quot;the number of variables.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">(</span><span class="n">no_of_var</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">no_of_var</span><span class="p">,</span> <span class="n">no_of_var</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The K matrix should be a square matrix with order equal to the number of variables. Got: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, Expected: </span><span class="si">{</span><span class="p">(</span><span class="n">no_of_var</span><span class="p">,</span> <span class="n">no_of_var</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">fun</span>

<div class="viewcode-block" id="CanonicalDistribution.assignment"><a class="viewcode-back" href="../../../../coreBN.factors.distributions.html#coreBN.factors.continuous.CanonicalDistribution.assignment">[docs]</a>    <span class="k">def</span> <span class="nf">assignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the probability value of the PDF at the given parameter values.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *x: values of all variables of this distribution,</span>
<span class="sd">            collective defining a point at which the probability value is to be computed.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float: The probability value at the point.</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from coreBN.factors.distributions import GaussianDistribution</span>
<span class="sd">        &gt;&gt;&gt; dist = GaussianDistribution(variables=[&#39;x1&#39;, &#39;x2&#39;],</span>
<span class="sd">        ...                             mean=[[0], [0]],</span>
<span class="sd">        ...                             cov=[[1, 0], [0, 1]])</span>
<span class="sd">        &gt;&gt;&gt; dist.assignment(0, 0)</span>
<span class="sd">        0.15915494309189535</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="CanonicalDistribution.copy"><a class="viewcode-back" href="../../../../coreBN.factors.distributions.html#coreBN.factors.continuous.CanonicalDistribution.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes a copy of the factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CanonicalDistribution object: Copy of the factor</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from coreBN.factors.continuous import CanonicalDistribution</span>
<span class="sd">        &gt;&gt;&gt; phi = CanonicalDistribution([&#39;X&#39;, &#39;Y&#39;], np.array([[1, -1], [-1, 1]]),</span>
<span class="sd">                                  np.array([[1], [-1]]), -3)</span>
<span class="sd">        &gt;&gt;&gt; phi.variables</span>
<span class="sd">        [&#39;X&#39;, &#39;Y&#39;]</span>

<span class="sd">        &gt;&gt;&gt; phi.K</span>
<span class="sd">        array([[1, -1],</span>
<span class="sd">               [-1, 1]])</span>

<span class="sd">        &gt;&gt;&gt; phi.h</span>
<span class="sd">        array([[1],</span>
<span class="sd">               [-1]])</span>

<span class="sd">        &gt;&gt;&gt; phi.g</span>
<span class="sd">        -3</span>

<span class="sd">        &gt;&gt;&gt; phi2 = phi.copy()</span>

<span class="sd">        &gt;&gt;&gt; phi2.variables</span>
<span class="sd">        [&#39;X&#39;, &#39;Y&#39;]</span>

<span class="sd">        &gt;&gt;&gt; phi2.K</span>
<span class="sd">        array([[1, -1],</span>
<span class="sd">               [-1, 1]])</span>

<span class="sd">        &gt;&gt;&gt; phi2.h</span>
<span class="sd">        array([[1],</span>
<span class="sd">               [-1]])</span>

<span class="sd">        &gt;&gt;&gt; phi2.g</span>
<span class="sd">        -3</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copy_factor</span> <span class="o">=</span> <span class="n">CanonicalDistribution</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">copy_factor</span></div>

<div class="viewcode-block" id="CanonicalDistribution.to_joint_gaussian"><a class="viewcode-back" href="../../../../coreBN.factors.distributions.html#coreBN.factors.continuous.CanonicalDistribution.to_joint_gaussian">[docs]</a>    <span class="k">def</span> <span class="nf">to_joint_gaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an equivalent Joint Gaussian Distribution.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from coreBN.factors.continuous import CanonicalDistribution</span>
<span class="sd">        &gt;&gt;&gt; phi = CanonicalDistribution([&#39;x1&#39;, &#39;x2&#39;], np.array([[3, -2], [-2, 4]]),</span>
<span class="sd">                                  np.array([[5], [-1]]), 1)</span>
<span class="sd">        &gt;&gt;&gt; jgd = phi.to_joint_gaussian()</span>
<span class="sd">        &gt;&gt;&gt; jgd.variables</span>
<span class="sd">        [&#39;x1&#39;, &#39;x2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; jgd.covariance</span>
<span class="sd">        array([[ 0.5  ,  0.25 ],</span>
<span class="sd">               [ 0.25 ,  0.375]])</span>
<span class="sd">        &gt;&gt;&gt; jgd.mean</span>
<span class="sd">        array([[ 2.25 ],</span>
<span class="sd">               [ 0.875]])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">covariance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">GaussianDistribution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">covariance</span><span class="p">)</span></div>

<div class="viewcode-block" id="CanonicalDistribution.reduce"><a class="viewcode-back" href="../../../../coreBN.factors.distributions.html#coreBN.factors.continuous.CanonicalDistribution.reduce">[docs]</a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduces the distribution to the context of the given variable values.</span>

<span class="sd">        Let C(X,Y ; K, h, g) be some canonical form over X,Y where,</span>

<span class="sd">        k = [[K_XX, K_XY],        ;       h = [[h_X],</span>
<span class="sd">             [K_YX, K_YY]]                     [h_Y]]</span>

<span class="sd">        The formula for the obtained conditional distribution for setting</span>
<span class="sd">        Y = y is given by,</span>

<span class="sd">        .. math:: K&#39; = K_{XX}</span>
<span class="sd">        .. math:: h&#39; = h_X - K_{XY} * y</span>
<span class="sd">        .. math:: g&#39; = g + {h^T}_Y * y - 0.5 * y^T * K_{YY} * y</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values: list, array-like</span>
<span class="sd">            A list of tuples of the form (variable name, variable value).</span>

<span class="sd">        inplace: boolean</span>
<span class="sd">            If inplace=True it will modify the factor itself, else would return</span>
<span class="sd">            a new CanonicalFactor object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CanonicalDistribution or None:</span>
<span class="sd">                if inplace=True (default) returns None</span>
<span class="sd">                if inplace=False returns a new CanonicalDistribution instance.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from coreBN.factors.continuous import CanonicalDistribution</span>
<span class="sd">        &gt;&gt;&gt; phi = CanonicalDistribution([&#39;X1&#39;, &#39;X2&#39;, &#39;X3&#39;],</span>
<span class="sd">        ...                       np.array([[1, -1, 0], [-1, 4, -2], [0, -2, 4]]),</span>
<span class="sd">        ...                       np.array([[1], [4], [-1]]), -2)</span>
<span class="sd">        &gt;&gt;&gt; phi.variables</span>
<span class="sd">        [&#39;X1&#39;, &#39;X2&#39;, &#39;X3&#39;]</span>

<span class="sd">        &gt;&gt;&gt; phi.K</span>
<span class="sd">        array([[ 1., -1.],</span>
<span class="sd">               [-1.,  3.]])</span>

<span class="sd">        &gt;&gt;&gt; phi.h</span>
<span class="sd">        array([[ 1. ],</span>
<span class="sd">               [ 3.5]])</span>

<span class="sd">        &gt;&gt;&gt; phi.g</span>
<span class="sd">        -2</span>

<span class="sd">        &gt;&gt;&gt; phi.reduce([(&#39;X3&#39;, 0.25)])</span>

<span class="sd">        &gt;&gt;&gt; phi.variables</span>
<span class="sd">        [&#39;X1&#39;, &#39;X2&#39;]</span>

<span class="sd">        &gt;&gt;&gt; phi.K</span>
<span class="sd">        array([[ 1, -1],</span>
<span class="sd">               [-1,  4]])</span>

<span class="sd">        &gt;&gt;&gt; phi.h</span>
<span class="sd">        array([[ 1. ],</span>
<span class="sd">               [ 4.5]])</span>

<span class="sd">        &gt;&gt;&gt; phi.g</span>
<span class="sd">        -2.375</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;variables: Expected type list or array-like, got type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Variable not in scope.&quot;</span><span class="p">)</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">var_to_reduce</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

        <span class="c1"># index_to_keep -&gt; j vector</span>
        <span class="n">index_to_keep</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">var_to_reduce</span>
        <span class="p">]</span>
        <span class="c1"># index_to_reduce -&gt; i vector</span>
        <span class="n">index_to_reduce</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">var_to_reduce</span><span class="p">]</span>

        <span class="n">K_i_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">index_to_keep</span><span class="p">,</span> <span class="n">index_to_keep</span><span class="p">)]</span>
        <span class="n">K_i_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">index_to_keep</span><span class="p">,</span> <span class="n">index_to_reduce</span><span class="p">)]</span>
        <span class="n">K_j_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">index_to_reduce</span><span class="p">,</span> <span class="n">index_to_reduce</span><span class="p">)]</span>
        <span class="n">h_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">index_to_keep</span><span class="p">]</span>
        <span class="n">h_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">index_to_reduce</span><span class="p">]</span>

        <span class="c1"># The values for the reduced variables.</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">value</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index_to_reduce</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">phi</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_to_keep</span><span class="p">]</span>
        <span class="n">phi</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K_i_i</span>
        <span class="n">phi</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h_i</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K_i_j</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">phi</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">h_j</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">multi_dot</span><span class="p">([</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">K_j_j</span><span class="p">,</span> <span class="n">y</span><span class="p">])))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">phi</span></div>

<div class="viewcode-block" id="CanonicalDistribution.marginalize"><a class="viewcode-back" href="../../../../coreBN.factors.distributions.html#coreBN.factors.continuous.CanonicalDistribution.marginalize">[docs]</a>    <span class="k">def</span> <span class="nf">marginalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the factor with marginalized values.</span>

<span class="sd">        Let C(X,Y ; K, h, g) be some canonical form over X,Y where,</span>

<span class="sd">        k = [[K_XX, K_XY],        ;       h = [[h_X],</span>
<span class="sd">             [K_YX, K_YY]]                     [h_Y]]</span>

<span class="sd">        In this case, the result of the integration operation is a canonical</span>
<span class="sd">        from C (K&#39;, h&#39;, g&#39;) given by,</span>

<span class="sd">        .. math:: K&#39; = K_{XX} - K_{XY} * {K^{-1}}_{YY} * K_YX</span>
<span class="sd">        .. math:: h&#39; = h_X - K_{XY} * {K^{-1}}_{YY} * h_Y</span>
<span class="sd">        .. math:: g&#39; = g + 0.5 * (|Y| * log(2*pi) - log(|K_{YY}|) + {h^T}_Y * K_{YY} * h_Y)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        variables: list or array-like</span>
<span class="sd">                List of variables over which to marginalize.</span>

<span class="sd">        inplace: boolean</span>
<span class="sd">                If inplace=True it will modify the distribution itself,</span>
<span class="sd">                else would return a new distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CanonicalDistribution or None :</span>
<span class="sd">                if inplace=True (default) returns None</span>
<span class="sd">                if inplace=False return a new CanonicalDistribution instance</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from coreBN.factors.continuous import CanonicalDistribution</span>
<span class="sd">        &gt;&gt;&gt; phi = CanonicalDistribution([&#39;X1&#39;, &#39;X2&#39;, &#39;X3&#39;],</span>
<span class="sd">        ...                       np.array([[1, -1, 0], [-1, 4, -2], [0, -2, 4]]),</span>
<span class="sd">        ...                       np.array([[1], [4], [-1]]), -2)</span>
<span class="sd">        &gt;&gt;&gt; phi.K</span>
<span class="sd">        array([[ 1, -1,  0],</span>
<span class="sd">                [-1,  4, -2],</span>
<span class="sd">                [ 0, -2,  4]])</span>

<span class="sd">        &gt;&gt;&gt; phi.h</span>
<span class="sd">        array([[ 1],</span>
<span class="sd">                [ 4],</span>
<span class="sd">                [-1]])</span>

<span class="sd">        &gt;&gt;&gt; phi.g</span>
<span class="sd">        -2</span>

<span class="sd">        &gt;&gt;&gt; phi.marginalize([&#39;X3&#39;])</span>

<span class="sd">        &gt;&gt;&gt; phi.K</span>
<span class="sd">        array([[ 1., -1.],</span>
<span class="sd">                [-1.,  3.]])</span>

<span class="sd">        &gt;&gt;&gt; phi.h</span>
<span class="sd">        array([[ 1. ],</span>
<span class="sd">                [ 3.5]])</span>

<span class="sd">        &gt;&gt;&gt; phi.g</span>
<span class="sd">        0.22579135</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;variables: Expected type list or array-like, got type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Variable not in scope.&quot;</span><span class="p">)</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># index_to_keep -&gt; i vector</span>
        <span class="n">index_to_keep</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variables</span>
        <span class="p">]</span>
        <span class="c1"># index_to_marginalize -&gt; j vector</span>
        <span class="n">index_to_marginalize</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>

        <span class="n">K_i_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">index_to_keep</span><span class="p">,</span> <span class="n">index_to_keep</span><span class="p">)]</span>
        <span class="n">K_i_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">index_to_keep</span><span class="p">,</span> <span class="n">index_to_marginalize</span><span class="p">)]</span>
        <span class="n">K_j_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">index_to_marginalize</span><span class="p">,</span> <span class="n">index_to_keep</span><span class="p">)]</span>
        <span class="n">K_j_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">index_to_marginalize</span><span class="p">,</span> <span class="n">index_to_marginalize</span><span class="p">)]</span>
        <span class="n">K_j_j_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">K_j_j</span><span class="p">)</span>
        <span class="n">h_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">index_to_keep</span><span class="p">]</span>
        <span class="n">h_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">index_to_marginalize</span><span class="p">]</span>

        <span class="n">phi</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_to_keep</span><span class="p">]</span>

        <span class="n">phi</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K_i_i</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">multi_dot</span><span class="p">([</span><span class="n">K_i_j</span><span class="p">,</span> <span class="n">K_j_j_inv</span><span class="p">,</span> <span class="n">K_j_i</span><span class="p">])</span>
        <span class="n">phi</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h_i</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">multi_dot</span><span class="p">([</span><span class="n">K_i_j</span><span class="p">,</span> <span class="n">K_j_j_inv</span><span class="p">,</span> <span class="n">h_j</span><span class="p">])</span>
        <span class="n">phi</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
            <span class="o">+</span> <span class="mf">0.5</span>
            <span class="o">*</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">K_j_j</span><span class="p">)))</span>
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">multi_dot</span><span class="p">([</span><span class="n">h_j</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">K_j_j</span><span class="p">,</span> <span class="n">h_j</span><span class="p">])</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">phi</span></div>

    <span class="k">def</span> <span class="nf">_operate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives the CanonicalDistribution operation (product or divide) with</span>
<span class="sd">        the other factor.</span>

<span class="sd">        The product of two canonical factors over the same scope</span>
<span class="sd">        X is simply:</span>

<span class="sd">        C(K1, h1, g1) * C(K2, h2, g2) = C(K1+K2, h1+h2, g1+g2)</span>

<span class="sd">        The division of canonical forms is defined analogously:</span>

<span class="sd">        C(K1, h1, g1) / C(K2, h2, g2) = C(K1-K2, h1-h2, g1- g2)</span>

<span class="sd">        When we have two canonical factors over different scopes X and Y,</span>
<span class="sd">        we simply extend the scope of both to make their scopes match and</span>
<span class="sd">        then perform the operation of the above equation. The extension of</span>
<span class="sd">        the scope is performed by simply adding zero entries to both the K</span>
<span class="sd">        matrices and the h vectors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other: CanonicalFactor</span>
<span class="sd">            The CanonicalDistribution to be multiplied.</span>

<span class="sd">        operation: String</span>
<span class="sd">            &#39;product&#39; for multiplication operation and</span>
<span class="sd">            &#39;divide&#39; for division operation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CanonicalDistribution or None:</span>
<span class="sd">                        if inplace=True (default) returns None</span>
<span class="sd">                        if inplace=False returns a new CanonicalDistribution instance.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from coreBN.factors.continuous import CanonicalDistribution</span>
<span class="sd">        &gt;&gt;&gt; phi1 = CanonicalDistribution([&#39;x1&#39;, &#39;x2&#39;, &#39;x3&#39;],</span>
<span class="sd">                                   np.array([[1, -1, 0], [-1, 4, -2], [0, -2, 4]]),</span>
<span class="sd">                                   np.array([[1], [4], [-1]]), -2)</span>
<span class="sd">        &gt;&gt;&gt; phi2 = CanonicalDistribution([&#39;x1&#39;, &#39;x2&#39;], np.array([[3, -2], [-2, 4]]),</span>
<span class="sd">                                   np.array([[5], [-1]]), 1)</span>

<span class="sd">        &gt;&gt;&gt; phi3 = phi1 * phi2</span>
<span class="sd">        &gt;&gt;&gt; phi3.K</span>
<span class="sd">        array([[ 4., -3.,  0.],</span>
<span class="sd">               [-3.,  8., -2.],</span>
<span class="sd">               [ 0., -2.,  4.]])</span>
<span class="sd">        &gt;&gt;&gt; phi3.h</span>
<span class="sd">        array([ 6.,  3., -1.])</span>
<span class="sd">        &gt;&gt;&gt; phi3.g</span>
<span class="sd">        -1</span>

<span class="sd">        &gt;&gt;&gt; phi4 = phi1 / phi2</span>
<span class="sd">        &gt;&gt;&gt; phi4.K</span>
<span class="sd">        array([[-2.,  1.,  0.],</span>
<span class="sd">               [ 1.,  0., -2.],</span>
<span class="sd">               [ 0., -2.,  4.]])</span>
<span class="sd">        &gt;&gt;&gt; phi4.h</span>
<span class="sd">        array([-4.,  5., -1.])</span>
<span class="sd">        &gt;&gt;&gt; phi4.g</span>
<span class="sd">        -3</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CanonicalDistribution</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;CanonicalDistribution object can only be multiplied or divided with an another CanonicalDistribution object. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">, expected CanonicalDistribution.&quot;</span>
            <span class="p">)</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">all_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span>
        <span class="p">]</span>
        <span class="n">no_of_var</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_vars</span><span class="p">)</span>

        <span class="n">self_var_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_vars</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">]</span>
        <span class="n">other_var_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_vars</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">variables</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">_extend_K_scope</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
            <span class="n">ext_K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">no_of_var</span><span class="p">,</span> <span class="n">no_of_var</span><span class="p">])</span>
            <span class="n">ext_K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">K</span>
            <span class="k">return</span> <span class="n">ext_K</span>

        <span class="k">def</span> <span class="nf">_extend_h_scope</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
            <span class="n">ext_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_of_var</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">no_of_var</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ext_h</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
            <span class="k">return</span> <span class="n">ext_h</span>

        <span class="n">phi</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">all_vars</span>

        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span>
            <span class="n">phi</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">_extend_K_scope</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">self_var_index</span><span class="p">)</span> <span class="o">+</span> <span class="n">_extend_K_scope</span><span class="p">(</span>
                <span class="n">other</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">other_var_index</span>
            <span class="p">)</span>
            <span class="n">phi</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">_extend_h_scope</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">self_var_index</span><span class="p">)</span> <span class="o">+</span> <span class="n">_extend_h_scope</span><span class="p">(</span>
                <span class="n">other</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">other_var_index</span>
            <span class="p">)</span>
            <span class="n">phi</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">g</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">phi</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">_extend_K_scope</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">self_var_index</span><span class="p">)</span> <span class="o">-</span> <span class="n">_extend_K_scope</span><span class="p">(</span>
                <span class="n">other</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">other_var_index</span>
            <span class="p">)</span>
            <span class="n">phi</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">_extend_h_scope</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">self_var_index</span><span class="p">)</span> <span class="o">-</span> <span class="n">_extend_h_scope</span><span class="p">(</span>
                <span class="n">other</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">other_var_index</span>
            <span class="p">)</span>
            <span class="n">phi</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">g</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">phi</span>

<div class="viewcode-block" id="CanonicalDistribution.product"><a class="viewcode-back" href="../../../../coreBN.factors.distributions.html#coreBN.factors.continuous.CanonicalDistribution.product">[docs]</a>    <span class="k">def</span> <span class="nf">product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the product of two gaussian distributions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other: CanonicalFactor</span>
<span class="sd">            The GaussianDistribution to be multiplied.</span>

<span class="sd">        inplace: boolean</span>
<span class="sd">            If True, modifies the distribution itself, otherwise returns a new</span>
<span class="sd">            CanonicalDistribution object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CanonicalDistribution or None:</span>
<span class="sd">                    if inplace=True (default) returns None.</span>
<span class="sd">                    if inplace=False returns a new CanonicalDistribution instance.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from coreBN.factors.distributions import GaussianDistribution as GD</span>
<span class="sd">        &gt;&gt;&gt; dis1 = GD([&#39;x1&#39;, &#39;x2&#39;, &#39;x3&#39;], np.array([[1], [-3], [4]]),</span>
<span class="sd">        ...            np.array([[4, 2, -2], [2, 5, -5], [-2, -5, 8]]))</span>
<span class="sd">        &gt;&gt;&gt; dis2 = GD([&#39;x3&#39;, &#39;x4&#39;], [1, 2], [[2, 3], [5, 6]])</span>
<span class="sd">        &gt;&gt;&gt; dis3 = dis1.product(dis2, inplace=False)</span>
<span class="sd">        &gt;&gt;&gt; dis3.covariance</span>
<span class="sd">        array([[ 3.6,  1. , -0.4, -0.6],</span>
<span class="sd">               [ 1. ,  2.5, -1. , -1.5],</span>
<span class="sd">               [-0.4, -1. ,  1.6,  2.4],</span>
<span class="sd">               [-1. , -2.5,  4. ,  4.5]])</span>
<span class="sd">        &gt;&gt;&gt; dis3.mean</span>
<span class="sd">        array([[ 1.6],</span>
<span class="sd">               [-1.5],</span>
<span class="sd">               [ 1.6],</span>
<span class="sd">               [ 3.5]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">)</span></div>

<div class="viewcode-block" id="CanonicalDistribution.divide"><a class="viewcode-back" href="../../../../coreBN.factors.distributions.html#coreBN.factors.continuous.CanonicalDistribution.divide">[docs]</a>    <span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the division of two gaussian distributions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other: GaussianDistribution</span>
<span class="sd">            The GaussianDistribution to be divided.</span>

<span class="sd">        inplace: boolean</span>
<span class="sd">            If True, modifies the distribution itself, otherwise returns a new</span>
<span class="sd">            GaussianDistribution object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CanonicalDistribution or None:</span>
<span class="sd">                    if inplace=True (default) returns None.</span>
<span class="sd">                    if inplace=False returns a new CanonicalDistribution instance.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from coreBN.factors.distributions import GaussianDistribution as GD</span>
<span class="sd">        &gt;&gt;&gt; dis1 = GD([&#39;x1&#39;, &#39;x2&#39;, &#39;x3&#39;], np.array([[1], [-3], [4]]),</span>
<span class="sd">        ...            np.array([[4, 2, -2], [2, 5, -5], [-2, -5, 8]]))</span>
<span class="sd">        &gt;&gt;&gt; dis2 = GD([&#39;x3&#39;, &#39;x4&#39;], [1, 2], [[2, 3], [5, 6]])</span>
<span class="sd">        &gt;&gt;&gt; dis3 = dis1.divide(dis2, inplace=False)</span>
<span class="sd">        &gt;&gt;&gt; dis3.covariance</span>
<span class="sd">        array([[ 3.6,  1. , -0.4, -0.6],</span>
<span class="sd">               [ 1. ,  2.5, -1. , -1.5],</span>
<span class="sd">               [-0.4, -1. ,  1.6,  2.4],</span>
<span class="sd">               [-1. , -2.5,  4. ,  4.5]])</span>
<span class="sd">        &gt;&gt;&gt; dis3.mean</span>
<span class="sd">        array([[ 1.6],</span>
<span class="sd">               [-1.5],</span>
<span class="sd">               [ 1.6],</span>
<span class="sd">               [ 3.5]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;divide&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">__div__</span> <span class="o">=</span> <span class="fm">__truediv__</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Serafina Di Gioia.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>